{% load staticfiles %}
<html>
<head>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.1/dist/leaflet.css" />
    <script src="https://npmcdn.com/leaflet@1.0.0-rc.1/dist/leaflet.js"></script>

    <!-- ESRI Leaflet -->
    <script src="https://unpkg.com/esri-leaflet@2.0.3"></script>

    <!-- CSS -->
    <link href="{% static 'css/base.css' %}" rel="stylesheet" />

    <!-- Jquery NEEDS to be unique for each app. Get new CND link here @ https://code.jquery.com/ -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

    <!-- Config -->
    <script src="{% static 'config/config_ca.js' %}"></script>

    <!-- JIT Model -->
    <script src="{% static 'json_models/terrestrial_intactness.json' %}"></script>

    <!-- JIT  -->
    <link type="text/css" href="{% static 'js/jit/my_jit/Spacetree.css' %}" rel="stylesheet" />
    <script src="{% static 'deps/jit/Jit-2.0.1/jit.js' %}"></script>
    <script src="{% static 'js/jit/my_jit/Spacetree.js' %}"></script>

    <!-- Alertify  -->
    <link type="text/css" href="{% static 'deps/alertify/alertify.js-0.3.11/themes/alertify.core.css' %}" rel="stylesheet" />
    <link type="text/css" href="{% static 'deps/alertify/alertify.js-0.3.11/themes/alertify.bootstrap.css' %}" rel="stylesheet" />
    <script src="{% static 'deps/alertify/alertify.js-0.3.11/lib/alertify.min.js' %}"></script>


</head>
<body>

    <div id="header">
        <div id="title">EEMS Online</div>
        <img id="logo_l" src="{% static 'img/eems_logo.png' %}">
        <img id="logo_r" src="{% static 'img/eems_logo_r.png' %}">
    </div>
    <div id="nav_bar">
        <ul>
            <li><a class="active" href="#home">Home</a></li>
            <li><a href="">Downloads</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="">Contact</a></li>
        </ul>
    </div>

    <div id="map_container">
        <div id="map"></div>
    </div>
    <div id="meemse_container">
        <div id="log"></div>
        <div id="infovis"></div>
        <div id="file_upload_controls">
            <label for="files" class="alertify-button alertify-button-ok" id="files_label">Select an EEMS File...</label>
            <input type="file" id="files" name="file" style="display:none"/>
            <div id="filename"></div>
            <span class="readBytesButtons">
              <!--
              <button data-startbyte="0" data-endbyte="4">1-5</button>
              <button data-startbyte="5" data-endbyte="14">6-15</button>
              <button data-startbyte="6" data-endbyte="7">7-8</button>
              -->
              <button class="alertify-button alertify-button-ok">Create EEMS Diagram</button>
              <button id="run_eems_button" class="alertify-button alertify-button-ok">Run EEMS Model</button>
            </span>

            <div id="byte_range" style="display:none"></div>
            <div id="byte_content" style="display:none"></div>
        </div>

    <script>

       $('input:file').change(
                function(e){
                    var filename=e.target.files[0].name
                    $("#filename").html("Selected File: " + filename)
      });

      function readBlob(opt_startByte, opt_stopByte) {

        var files = document.getElementById('files').files;
        if (!files.length) {
          alert('Please select a file!');
          return;
        }

        var file = files[0];
        var start = parseInt(opt_startByte) || 0;
        var stop = parseInt(opt_stopByte) || file.size - 1;

        var reader = new FileReader();

        // If we use onloadend, we need to check the readyState.
        reader.onloadend = function(evt) {
          if (evt.target.readyState == FileReader.DONE) { // DONE == 2
            document.getElementById('byte_content').textContent = evt.target.result;
            document.getElementById('byte_range').textContent =
                ['Read bytes: ', start + 1, ' - ', stop + 1,
                 ' of ', file.size, ' byte file'].join('');
            json_string = JSON.stringify(eval("(" + evt.target.result + ")"));
            json = JSON.parse(json_string);
            $("#infovis").empty()
            init()
          }
        };

        var blob = file.slice(start, stop + 1);
        reader.readAsBinaryString(blob);
      }

      document.querySelector('.readBytesButtons').addEventListener('click', function(evt) {
        if (evt.target.tagName.toLowerCase() == 'button') {
          var startByte = evt.target.getAttribute('data-startbyte');
          var endByte = evt.target.getAttribute('data-endbyte');
          readBlob(startByte, endByte);
        }
      }, false);

    </script>

    <script>

        jQuery("input#files").change(function () {
            //alert(jQuery(this).val())
        });

    </script>

    </div>

    <!-- Leaflet Map -->
    <script src="{% static 'leaflet/leaflet_map.js' %}"></script>

    <!-- General Javascript -->
    <script src="{% static 'js/general_js.js' %}"></script>


</body>

</html>
